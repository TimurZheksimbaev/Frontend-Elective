<!-- Go to index.html and press Get Comic it will redirect to this page -->
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Comic View</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #f4f4f4;
                margin: 0;
                padding: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            #comic-container {
                background-color: #fff;
                border: 1px solid #ddd;
                padding: 20px;
                max-width: 500px;
                margin: auto;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                text-align: center;
            }
            h2 {
                color: #333;
            }
            p {
                color: #666;
            }
            img {
                max-width: 100%;
                height: auto;
                display: block;
                margin: 20px 0;
            }
        </style>
    </head>

    <body>
        <main>
            <div id="comic-container"></div>
        </main>
        
        
        <script>
            const email = 't.zheksimbaev@innopolis.university';
            const baseUrl = new URL('https://fwd.innopolis.university/api/');
            
            async function getComicId(email) {
                // getting id from cache
                const cachedComicId = localStorage.getItem("comicId")
                if (cachedComicId) {
                    return Promise.resolve(cachedComicId)
                }

                // add params
                const idUrl = new URL('hw2', baseUrl);
                if (email) {
                    idUrl.searchParams.append('email', email);
                } else {
                    console.error("No email or invalid email", error)
                }
                
                // fetch comic id
                try {
                    const response = await fetch(idUrl);
                    const id = await response.json()
                    // cache id for fast retrieve in future
                    localStorage.setItem("comicId", id)
                    return id
                } catch (error) {
                    console.error('Error fetching comic ID:', error);
                    throw error;
                }
            }

            async function getComicData(email) {
                const comicId = await getComicId(email)
                const comicUrl = new URL('comic', baseUrl)
                // add params
                if (comicId) {
                    comicUrl.searchParams.append('id', comicId);
                } else {
                    console.error('No id', error)
                }
                
                // fetch comic data
                try {
                    const response = await fetch(comicUrl);
                    return response.json();
                } catch (error) {
                    console.error('Error fetching comic details:', error);
                    throw error;
                }
            }

            function displayComic(comic) {
                const container = document.getElementById('comic-container');
                
                // safe title
                const title = document.createElement('h2');
                title.textContent = comic.safe_title;
                
                // date
                console.log(comic.month)
                const date = new Date(comic.year, comic.month-1, comic.day);
                const dateElement = document.createElement('p');
                dateElement.textContent = date.toLocaleDateString();

                // image
                const img = document.createElement('img');
                img.src = comic.img;
                img.alt = comic.alt;

                // adding everything to container
                container.appendChild(title);
                container.appendChild(dateElement);
                container.appendChild(img);
            }

            async function main() {
                try {
                    const comic = await getComicData(email);
                    displayComic(comic);
                } catch (error) {
                    console.error('Error processing comic:', error);
                }
            }

            main();

        </script>
    </body>
</html>